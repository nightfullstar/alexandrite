<Sidebar
	counts={siteCounts}
	description={siteView.site.description ?? ''}
	sidebar={siteView.site.sidebar}
	context="Sizin Sunucunuz"
>
	<span slot="name" class="f-row gap-2 align-items-center"
		><InstanceLogo size="3rem" /><NameAtInstance prefix="" place={{ ...siteView.site, local: true }} />
	</span>
	<Stack slot="actions" dir="c" gap={2} cl="mt-2">
		{#if tagline}
			<Alert variant="info"><Markdown md={tagline.content} /></Alert>
		{/if}
	</Stack>
	<div slot="end">
		<ModlogLink highlight={isAdmin ?? false} highlightColor="orange" warn={$showModlogWarning} />
	</div>
</Sidebar>

<script lang="ts">
	import { Alert, Stack } from 'sheodox-ui';
	import Sidebar from '$lib/Sidebar.svelte';
	import NameAtInstance from '$lib/NameAtInstance.svelte';
	import ModlogLink from '$lib/ModlogLink.svelte';
	import Markdown from '$lib/Markdown.svelte';
	import { getAppContext } from '$lib/app-context';
	import InstanceLogo from '../../routes/(app)/[instance]/InstanceLogo.svelte';
	import type { Tagline } from 'lemmy-js-client';
	import { getSettingsContext } from '$lib/settings-context';

	const { siteMeta } = getAppContext();
	const { showModlogWarning } = getSettingsContext();
	$: siteView = $siteMeta.site_view;
	$: isAdmin = $siteMeta.admins.some(
		(admin) => admin.person.actor_id === $siteMeta.my_user?.local_user_view.person.actor_id
	);

	$: siteCounts = [
		{
			label: 'Kullanıcılar',
			icon: 'users',
			value: siteView.counts.users
		},
		{
			label: 'Gönderiler',
			icon: 'file-lines',
			value: siteView.counts.posts
		},
		{
			label: 'Yorumlar',
			icon: 'comments',
			value: siteView.counts.comments
		},
		{
			label: 'Sunucu Versiyonu',
			icon: 'code-branch',
			value: $siteMeta.version
		}
	];

	$: tagline = randomTagline($siteMeta.taglines);

	function randomTagline(taglines: Tagline[]) {
		if (!taglines.length || false) {
			return null;
		}

		return taglines[Math.floor(Math.random() * taglines.length)];
	}
</script>
